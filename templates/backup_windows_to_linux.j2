{% set step_counter = 1 %}
{{ step_counter }}. On Windows source server, install rsync (via Cygwin, WSL, or native).

{% set step_counter = step_counter + 1 %}
{{ step_counter }}. {% if versioning %}On Linux target server, create timestamped target folder:
   TIMESTAMP=$(date +"%Y%m%d")
   TARGET_FOLDER="{{ target_base }}/$TIMESTAMP"
   mkdir -p "$TARGET_FOLDER"
{% else %}Use target folder: {{ target_base }}
{% endif %}

{% set step_counter = step_counter + 1 %}
{{ step_counter }}. Back up source folders to defined backup location
{% for source_path in source_paths %}
{{ step_counter }}.{{ loop.index }}. Run rsync from Windows source {{ source_path }} to Linux target {{ target_host }}:
   rsync {{ rsync_options }} {{ source_path }} {{ target_user }}@{{ target_host }}:{{ target_folder }}/
{% endfor %}

{% set step_counter = step_counter + 1 %}
{{ step_counter }}. Verify the files on Linux target {{ target_host }}.

{% if retention_days and versioning %}
    {% set step_counter = step_counter + 1 %}
{{ step_counter }}. Optional: remove old backups older than {{ retention_days }} days on Linux target:
   find {{ target_base }}/ -maxdepth 1 -type d -mtime +{{ retention_days }} -exec rm -rf {} \;
{% endif %}